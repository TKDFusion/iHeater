

#========================================================
#=====================iHeater cfg========================
#========================================================

#=====================iHeater pins=======================
[board_pins iHeater_Aliases]
mcu: iHeater
aliases:
    TH0=PA3, TH1=PA0, TH2=PB1,
    HEATER=PA1, FAN=PA2,
    MODE=PA4,
    LED1=PA7, LED2=PA6, LED3=PA5,
    USART1_TX=PA9, USART1_RX=PA10

#=====================iHeater mcu=======================
# [mcu]
# serial: /dev/serial/by-id/usb-Klipper_stm32f042x6_0C0018000D53304347373020-if00

[mcu iHeater] #second MCU
is_non_critical: true # flag this as non critical
serial: /dev/serial/by-id/usb-Klipper_stm32f042x6_430018000E53304347373020-if01
restart_method: command

#============================================================
#======================= iHeater CONFIG =====================
#============================================================

# Make sure to perform PID calibration for the chamber heater:
#üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
#  PID_CALIBRATE HEATER=iHeater_H TARGET=70
#üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•üî•
# This is essential for accurate and stable chamber heating.
# Without PID tuning, the temperature may overshoot or take too long to stabilize!

#===========================================================

[heater_generic iHeater_H]
heater_pin: iHeater:HEATER
max_power: 1
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: iHeater:TH0
pwm_cycle_time: 0.3
min_temp: 0
max_temp: 120
control: pid
pid_Kp: 37.948
pid_Ki: 2.040
pid_Kd: 176.497

[verify_heater iHeater_H]
max_error: 240
check_gain_time: 1800
heating_gain: 1

[heater_fan chamber_heater_fan]
pin: iHeater:FAN
heater: iHeater_H
heater_temp: 50.0
fan_speed: 1.0
shutdown_speed: 0
kick_start_time: 0.5

[temperature_sensor iHeater_S]
sensor_pin: iHeater:TH1
sensor_type: NTC 100K MGB18-104F39050L32
min_temp: 0
max_temp: 140

[temperature_sensor iHeater_Chamber_ext]
sensor_pin: iHeater:TH2
sensor_type: NTC 100K MGB18-104F39050L32
min_temp: 0
max_temp: 140

[gcode_button mode_button]
pin: iHeater:MODE
# debounce_delay: 50
press_gcode: iHEATER_OFF

[output_pin led_1]
pin: iHeater:LED1

[output_pin led_2]
pin: iHeater:LED2

[output_pin led_3]
pin: iHeater:LED3

#######################################################
##########################SETUP########################
#######################################################

[gcode_macro CHAMBER_VARS]
variable_chamber_target: 0          # —Ü–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–º–µ—Ä—ã, ¬∞C
variable_chamber_await_target: 0    # –¥–æ–ø—É—Å—Ç–∏–º–∞—è –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–µ—á–∞—Ç–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–º–µ—Ä—ã, ¬∞C
variable_delta_temp: 10             # –¥–µ–ª—å—Ç–∞ –º–µ–∂–¥—É –∫–∞–º–µ—Ä–æ–π –∏ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª–µ–º, ¬∞C
variable_min_heater_temp: 50        # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è (–¥–ª—è –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è), ¬∞C
variable_max_heater_temp: 100       # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è, ¬∞C
variable_control_interval: 1.0      # –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Å–µ–∫—É–Ω–¥—ã
variable_air_min_delta: 0.5         # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∂–µ–ª–∞–µ–º–æ–π –∏ —Ç–µ–∫—É—â–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –∫–∞–º–µ—Ä—ã (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è —Ä–∞–≤–Ω–∞ –∂–µ–ª–∞–µ–º–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ + delta_temp), ¬∞C
variable_air_max_delta: 5.0         # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∂–µ–ª–∞–µ–º–æ–π –∏ —Ç–µ–∫—É—â–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –∫–∞–º–µ—Ä—ã (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è —Ä–∞–≤–Ω–∞ max_heater_temp), ¬∞C
gcode:

##########################MACRO########################

[gcode_macro M141]
#rename_existing: M141.1
gcode:
    # –ü–æ–ª—É—á–∞–µ–º –∂–µ–ª–∞–µ–º—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∫–∞–º–µ—Ä—ã: 
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä S - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ chamber_target –∏–∑ CHAMBER_VARS
    {% set chamber_target = params.S|default(printer["gcode_macro CHAMBER_VARS"].chamber_target)|int %}
    # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–π –¥–µ–ª—å—Ç—ã:
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä D - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ delta_temp –∏–∑ CHAMBER_VARS
    {% set delta_temp = params.D|default(printer["gcode_macro CHAMBER_VARS"].delta_temp)|int %}
    # –ü–æ–ª—É—á–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è:
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä H - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ max_heater_temp –∏–∑ CHAMBER_VARS
    {% set max_heater_temp = params.H|default(printer["gcode_macro CHAMBER_VARS"].max_heater_temp)|int %}
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    {% set control_interval = printer["gcode_macro CHAMBER_VARS"].control_interval|float %}

    RESPOND prefix="M141" msg="S{chamber_target} D{delta_temp} H{max_heater_temp}"

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ CHAMBER_VARS –¥–ª—è delayed_gcode
    SET_GCODE_VARIABLE MACRO=CHAMBER_VARS VARIABLE=chamber_target VALUE={chamber_target}
    SET_GCODE_VARIABLE MACRO=CHAMBER_VARS VARIABLE=delta_temp VALUE={delta_temp}
    SET_GCODE_VARIABLE MACRO=CHAMBER_VARS VARIABLE=max_heater_temp VALUE={max_heater_temp}

    # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    iHEATER_CONTROL

    # –ó–∞–ø—É—Å–∫–∞–µ–º –º–∞–∫—Ä–æ—Å –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
    UPDATE_DELAYED_GCODE ID=_iHEATER_CONTROL DURATION={control_interval}


[gcode_macro M191]
#rename_existing: M191.1
gcode:
    # –ü–æ–ª—É—á–∞–µ–º –∂–µ–ª–∞–µ–º—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∫–∞–º–µ—Ä—ã: 
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä S - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ chamber_target –∏–∑ CHAMBER_VARS
    {% set chamber_target = params.S|default(printer["gcode_macro CHAMBER_VARS"].chamber_target)|int %}
    # –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–π –¥–µ–ª—å—Ç—ã:
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä D - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ delta_temp –∏–∑ CHAMBER_VARS
    {% set delta_temp = params.D|default(printer["gcode_macro CHAMBER_VARS"].delta_temp)|int %}
    # –ü–æ–ª—É—á–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è:
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä H - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ max_heater_temp –∏–∑ CHAMBER_VARS
    {% set max_heater_temp = params.H|default(printer["gcode_macro CHAMBER_VARS"].max_heater_temp)|int %}
    # –ü–æ–ª—É—á–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∫–∞–º–µ—Ä—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–µ—á–∞—Ç–∏:
    # - –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä W - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    # - –∏–Ω–∞—á–µ –±–µ—Ä—ë–º –∑–Ω–∞—á–µ–Ω–∏–µ chamber_await_target –∏–∑ CHAMBER_VARS
    {% set chamber_await_target = params.W|default(printer["gcode_macro CHAMBER_VARS"].chamber_await_target)|int %}
    
    RESPOND prefix="M191" msg="S{chamber_target} D{delta_temp} H{max_heater_temp} W{chamber_await_target}"

    M141 S{chamber_target} D{delta_temp} H{max_heater_temp}

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç–µ—Ä –≤ CHAMBER_VARS
    SET_GCODE_VARIABLE MACRO=CHAMBER_VARS VARIABLE=chamber_await_target VALUE={chamber_await_target}

    # –ñ–¥—ë–º, –ø–æ–∫–∞ –∫–∞–º–µ—Ä–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
    TEMPERATURE_WAIT SENSOR="temperature_sensor iHeater_S" MINIMUM={chamber_target - chamber_await_target}
    RESPOND prefix="M191" msg="–ö–∞–º–µ—Ä–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã {chamber_await_target}¬∞C"


[gcode_macro iHEATER_ON]
description: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∫–æ–º–∞–Ω–¥–∞–º M141 & M191 —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
gcode:
    {% set s = params.CHAMBER_TEMP|default(printer["gcode_macro CHAMBER_VARS"].chamber_target)|int %}
    {% set d = params.DELTA|default(printer["gcode_macro CHAMBER_VARS"].delta_temp)|int %}
    {% set h = params.HEATER_MAX|default(printer["gcode_macro CHAMBER_VARS"].max_heater_temp)|int %}
    {% set w = params.CHAMBER_AWAIT_TEMP|default(printer["gcode_macro CHAMBER_VARS"].chamber_await_target)|int %}

    {% if w > 0 %}
        # –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä w –±–æ–ª—å—à–µ 0, —Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º M191 —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è –ø–µ—á–∞—Ç–∏
        M191 S{s} D{d} H{h} W{w}
    {% else %}
        # –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º M141 –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∫–∞–º–µ—Ä—ã
        M141 S{s} D{d} H{h}
    {% endif %}


[gcode_macro iHEATER_OFF]
gcode:
    SET_GCODE_VARIABLE MACRO=CHAMBER_VARS VARIABLE=chamber_target VALUE=0
    SET_GCODE_VARIABLE MACRO=CHAMBER_VARS VARIABLE=chamber_await_target VALUE=0

    UPDATE_DELAYED_GCODE ID=_iHEATER_CONTROL DURATION=1
    RESPOND prefix="iHeater_off" msg="–ù–∞–≥—Ä–µ–≤ –æ—Ç–∫–ª—é—á—ë–Ω."


[gcode_macro iHEATER_CONTROL]
gcode:
    # –¶–µ–ª–µ–≤–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞–º–µ—Ä—ã
    {% set target_chamber_temp = printer["gcode_macro CHAMBER_VARS"].chamber_target|float %}
    # –î–µ–ª—å—Ç–∞ - –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∫–∞–º–µ—Ä—ã
    {% set delta_temp = printer["gcode_macro CHAMBER_VARS"].delta_temp|float %}
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è
    {% set min_heater_temp = printer["gcode_macro CHAMBER_VARS"].min_heater_temp|float %}
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è
    {% set max_heater_temp = printer["gcode_macro CHAMBER_VARS"].max_heater_temp|float %}
    # –¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è
    {% set heater_temp = printer["heater_generic iHeater_H"].temperature|float %}
    # –¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–∑–¥—É—Ö–∞ –≤ –∫–∞–º–µ—Ä–µ (—Å —Ç–µ—Ä–º–æ–¥–∞—Ç—á–∏–∫–∞)
    {% set chamber_temp = printer["temperature_sensor iHeater_S"].temperature|float %}
    # –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    {% set control_interval = printer["gcode_macro CHAMBER_VARS"].control_interval|float %}
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∂–µ–ª–∞–µ–º–æ–π –∏ —Ç–µ–∫—É—â–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π  
    {% set air_min_delta = printer["gcode_macro CHAMBER_VARS"].air_min_delta|float %}
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∂–µ–ª–∞–µ–º–æ–π –∏ —Ç–µ–∫—É—â–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π  
    {% set air_max_delta = printer["gcode_macro CHAMBER_VARS"].air_max_delta|float %}
    # –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ü–µ–ª–µ–≤–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è
    {% set target_heater_temp = 0.0 %}

    # RESPOND prefix="iHeater_control" msg="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª–µ–º..."

    {% if target_chamber_temp > 0 %}
        # –ù–∞–≥—Ä–µ–≤ –∞–∫—Ç–∏–≤–µ–Ω
        {% set temp_diff = target_chamber_temp - chamber_temp %}

        # MapToRange
        {% set value = temp_diff %}
        {% set inputLowerBound = air_min_delta %}
        {% set inputUpperBound = air_max_delta %}
        {% set outputLowerBound = delta_temp %}
        {% set outputUpperBound = [delta_temp, max_heater_temp - target_chamber_temp]|max %}

        {% set slope = (outputUpperBound - outputLowerBound) / (inputUpperBound - inputLowerBound) %}
        {% set clamped = ([inputLowerBound, value, inputUpperBound]|sort)[1] %}
        {% set adjustment = outputLowerBound + slope * (clamped - inputLowerBound) %}   
        {% set target_heater_temp = (target_chamber_temp + adjustment)|round(2) %}

    {% elif heater_temp > min_heater_temp %}
        # –ù–∞–≥—Ä–µ–≤ –≤—ã–∫–ª—é—á–µ–Ω, –Ω–æ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–µ –æ—Å—Ç—ã–ª
        RESPOND prefix="iHeater_control" msg="–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è..."
    {% else %}
        # –ù–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—å –æ—Å—Ç—ã–ª - –∑–∞–≤–µ—Ä—à–∞–µ–º –º–∞–∫—Ä–æ—Å
        RESPOND prefix="iHeater_control" msg="–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–æ."
        {% set control_interval = 0.0 %}
    {% endif %}

    SET_HEATER_TEMPERATURE HEATER=iHeater_H TARGET={target_heater_temp}
    UPDATE_DELAYED_GCODE ID=_iHEATER_CONTROL DURATION={control_interval}


[delayed_gcode _iHEATER_CONTROL]
gcode:
    iHEATER_CONTROL