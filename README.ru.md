# О проекте iHeater

iHeater - это компактное и мощное решение для создания активной термокамеры в любом 3D-принтере. Он особенно незаменим для моделей с закрытой или проприетарной электроникой, таких как Creality, Bambu Lab, FlashForge, где часто не хватает свободных разъёмов или возможностей для подключения нагревателя, вентилятора и термистора.

iHeater подключается всего по USB и берёт управление на себя - независимо от ограничений основной платы. В зависимости от используемой прошивки он может работать автономно или в полной интеграции с Klipper .

В сочетании с нагревом стола iHeater обеспечивает и равномерный прогрев камеры - это ключевой фактор при печати ABS, PA, PC и других инженерных пластиков. Устройство динамически управляет нагревом в зависимости от температуры воздуха, создавая стабильные условия внутри камеры без перегрева и скачков.

Сейчас существует две версии:
- 100W для небольших принтеров(архивная)
- 200W для принтеров большего размера

![iHeater](imgweb/iHeater_promo.png)
## Варианты использования
### Под управлением Klipper

Плата работает как отдельный MCU в Klipper, полностью автономно управляя нагревом камеры и вентилятором. Благодаря питанию от 220В, iHeater не нагружает блок питания принтера, что особенно важно, учитывая, что штатные БП часто работают на пределе.

![PCB](imgweb/iHeater_200_PCB.png)

Стоимость платы сопоставима или даже ниже, чем самостоятельная сборка аналогичного решения на базе обычного микроконтроллера, твердотельного реле и других необходимых комплектующих. Тем не менее, для энтузиастов остаётся возможность собрать аналог самостоятельно.

iHeater - это простой способ добавить нагрев камеры в ваш принтер, для повышения качества печати и расширения диапазона применяемых материалов.


### С прошивкой iHeater

[![GitHub](https://img.shields.io/badge/GitHub-Repo-black?logo=github)](https://github.com/pavluchenkor/iHeater-Standalone-Firmware)

Плата iHeater является самодостаточной и имеет всю необходимую периферию и интерфейс управления и отображения для использования как самостоятельное устройство. Необходимая температура задается последовательным нажатием кнопки MODE, а выбранная температура кодируется и отображается тремя светодиодами. Приращение можно изменить в прошивке.

<!-- ### Подготовка

#### Сборка аппаратной части
   - Подключите нагревательный элемент и вентилятор к iHeater.
   - Подключите KSD в соответствующий разъем.
   - Установите терморезисторы в камере и подключите их к соответствующим пинам MCU.
   - Убедитесь в правильности подключения пинов согласно конфигурационному файлу.

#### Установка необходимых файлов
   - Скопируйте файл iHeater.cfg в директорию конфигурации Klipper.


### Установка Katapult Bootloader

Этот документ содержит инструкции по сборке и прошивке загрузчика **Katapult** от Klipper для микроконтроллера **STM32F042F6P6**. Загрузчик Katapult позволяет прошивать прошивку Klipper по USB без ST-Link и перевода в DFU с использованием джампера.

---

#### Что потребуется

- STM32F042F6P6
- Плата iHeater
- ST-Link V2 программатор (для первой прошивки) или USB кабель
- Linux-система (например, Raspberry Pi или принтер)

---

#### Сборка Katapult

1. Клонируем репозиторий Katapult:

```bash
git clone https://github.com/Arksine/katapult
cd katapult
make menuconfig
```

2. В `menuconfig` выбери:

- MCU Architecture: STM32
- Processor model: STM32F042
- Clock Reference: Internal
- Communication interface: USB (on PA9/PA10)
- Application start offset: **8KiB offset**
- [x] Support bootloader entry on rapid double click of reset button
- [x] Enable bootloader entry on button (or gpio) state
- (!PA4)  Button GPIO Pin
- [X] Enable Status LED
- (PA5)   Status LED GPIO Pin


![menuconfig](imgweb/katapult_menuconfig.jpg)

3. Сборка:

```bash
make
```

Прошивка будет создана в `out/katapult.bin`.


---

#### Прошивка Katapult через DFU

> Этот шаг нужен только один раз, для загрузки самого Katapult.

##### Подготовка:
Установи утилиту dfu-util, если она ещё не установлена:
    
    sudo apt install dfu-util

Установи джампер на BOOT0 и перезапусти питание платы (или нажми кнопку RESET).
Микроконтроллер загрузится в режим DFU.

Проверь подключение:

    lsusb

Ты должен увидеть:

    ID 0483:df11 STMicroelectronics STM Device in DFU Mode

##### Прошивка Katapult:
Выполни команду:

    dfu-util -a 0 -D out/katapult.bin -s 0x08000000:leave

Пример успешной прошивки:

    Downloading to address = 0x08000000, size = 4968
    Download        [=========================] 100%         4968 bytes
    Download done.
    File downloaded successfully
    Transitioning to dfuMANIFEST state

Сними перемычку, удерживая кнопку MODE нажми и отпусти кнопку RESET(или переподключи USB-кабель).

После перезапуска плата появится как:

    ls /dev/serial/by-id/*

    /dev/serial/by-id/usb-katapult_stm32f042x6_XXXXXXXXXXXXXX-if00

Если нет прав, возможны ошибки при прошивке, чтобы получить доступ выполни команду:
```
sudo chmod 777 /dev/serial/by-id/usb-katapult_stm32f042x6_XXXXXXXXXXXXXX-if00
``` 

#### Прошивка Katapult через ST-Link

> Этот шаг нужен только один раз, для загрузки самого Katapult в случае если режим DFU недоступен.

##### Подключение ST-Link:

| ST-Link | STM32     |
|---------|-----------|
| SWDIO   | PA13      |
| SWCLK   | PA14      |
| GND     | GND       |
| 3.3V    | VDD       |

##### Установка утилиты `st-flash`:

```bash
sudo apt install stlink-tools
```

##### Прошивка:

```bash
sudo st-flash write out/katapult.bin 0x08000000
```

Если всё в порядке, появится сообщение:

```
Flash written and verified! jolly good!
```

#### Примечания

- Katapult занимает первые 8 КБ Flash, поэтому **в Klipper обязательно указывать смещение 8 KiB**.
- Можно использовать либо двойной Reset, либо кнопку на GPIO (PA4) для входа в загррузки прошивки.
- После прошивки Katapult можно больше не использовать ST-Link - вся дальнейшая работа по USB.
 -->




<!-- ## CAD файлы iHeater

В этой директории находятся 3D-модели компонентов корпуса и креплений устройства iHeater. -->
<!-- 
### Список файлов

| Файл | Описание |
|------|----------|
| [`Base.stl`](CAD/Base.stl) | Основание корпуса, на котором крепятся все компоненты |
| [`Cover Two Color.stl`](CAD/Cover%20Two%20Color.stl) | Верхняя крышка  печатается в два цвета|
| [`Cover.stl`](CAD/Cover.stl) | Верхняя крышка|
| [`iHeater.stp`](CAD/iHeater.stp) | Полная сборка в формате STEP (для CAD-систем) |

### Форматы файлов

- `.stl` - используется для 3D-печати.
- `.stp` - используется для редактирования сборки в CAD-программах (Fusion 360, FreeCAD и т.д.).

### Как использовать

1. Откройте [`iHeater.stp`](CAD/iHeater.stp) в вашей CAD-программе для обзора всей сборки.
2. Загрузите STL-файлы в ваш слайсер для подготовки к 3D-печати.
3. Убедитесь, что при импорте выбран масштаб **миллиметры (mm)**.

### Примечания

- Убедитесь, что вентиляционные отверстия не перекрыты при установке.
- STL-файлы оптимизированы для печати без поддержки.

---

[_Если вы редактируете CAD-файлы - не забудьте обновить и этот документ!_](User%20mods/README.md) -->
<!-- 
## Сборка

### Установка платы
![Сборка iHeater](imgweb/iHeater_5484.jpg)

### Установка Термистора и KSD
![Сборка iHeater](imgweb/iHeater_5489.jpg)

### Установка нагревателя
![Сборка iHeater](imgweb/iHeater_5491.jpg)

### Проводка
![Сборка iHeater](imgweb/iHeater_5494.jpg)

### Установка НШВИ
![Сборка iHeater](imgweb/iHeater_5496.jpg)

### Коммутация
![Сборка iHeater](imgweb/iHeater_5498.jpg)

### Финальная сборка
![Сборка iHeater](imgweb/iHeater_5500.jpg)

### Готовое изделие
![Сборка iHeater](imgweb/iHeater_5506.jpg) -->


## Лицензия
Данный проект распространяется под лицензией MIT. Подробности смотрите в файле [LICENSE](license.md).


>⚠️  ** Внимание: Использование нагревательных элементов и управление температурой связано с риском возгорания и повреждения оборудования. Всегда следуйте рекомендациям производителя и соблюдайте меры предосторожности.